{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'quick-add.css' | asset_url | stylesheet_tag }}
<script src="{{ 'quick-add.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>
{{ 'section-blog-post.css' | asset_url | stylesheet_tag }}

{% assign time = article.metafields.custom.preparation_time.value %}
{% assign servings = article.metafields.custom.number_of_servings.value %}

<article class="article recipes__article">
  <div class="container">
    <div class="article__wrapper">
      <div class="article__image">
        <picture>
          {% if article.image != blank %}
            <img src="{{ article.image | image_url }}" alt="{{ article.image.alt }}">
          {% else %}
            <img src="https://fotobym.com.ua/uploads/images/product/480/f37e95c0a03b0b49c82e71bdb81494a3.jpg"
                 alt=""/>
          {% endif %}
        </picture>
      </div>
      <div class="article__header">
        <div class="article__subtitle">
          {% if article.tags.size > 0 %}
            {{ article.tags | first }}
          {% endif %}
        </div>
        <h1 class="article__title">
          {{ article.title }}
        </h1>

        {% if time != blank or servings != blank %}
          <div class="article__row">
            {% if servings != blank %}
              <span>Number of servings: <strong>{{ servings }}</strong> </span>
            {% endif %}

            {% if time != blank %}
              <span>Preparation time: <strong>{{ time }}</strong></span>
            {% endif %}
          </div>
        {% endif %}
      </div>
      <div class="article__content">
        <div class="article__text">
          {{ article.content }}
        </div>
        {% if article.metafields.custom.products != blank %}
          <div class="article__products">
            <div class="article__prod-title center">
              Products from the recipe
            </div>
            <div class="article__slider swiper">
              <div class="swiper-wrapper">
                {% for card_product in article.metafields.custom.products.value %}
                  <div class="swiper-slide article__slider-slide">
                    {% render 'card-product',
                        card_product: card_product,
                        show_secondary_image: false,
                        image_shape: 'default',
                        media_aspect_ratio: 'square',
                        show_vendor: true,
                        show_rating: false,
                        lazy_load: true,
                        show_quick_add: true,
                        section_id: section.id
                    %}
                  </div>
                {% endfor %}
              </div>
              <div class="banner__pagination"></div>
            </div>

          </div>
        {% endif %}
      </div>
    </div>
  </div>

  {%- if blog.comments_enabled? -%}
    <div class="article-template__comment-wrapper background-secondary">
      <div
          id="comments"
          class="container {% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
      >
        {%- if article.comments_count > 0 -%}
          {%- assign anchorId = '#Comments-' | append: article.id -%}

          <h2 id="Comments-{{ article.id }}" tabindex="-1">
            {{ 'blogs.article.comments' | t: count: article.comments_count }}
          </h2>
          {% paginate article.comments by 5 %}
            <div class="article-template__comments">
              {%- if comment.status == 'pending' and comment.content -%}
                <article id="{{ comment.id }}">
                  <div>
                    <header class="article-template__comments-comment-header">
                      <span class="caption-with-letter-spacing">{{ comment.author }}</span>
                    </header>
                  </div>
                  <div  class="article-template__comments-comment">
                    {{ comment.content }}
                  </div>
                </article>
              {%- endif -%}

              {%- for comment in article.comments -%}
                <article id="{{ comment.id }}">
                  <div>
                    <header class="article-template__comments-comment-header">
                      <span class="caption-with-letter-spacing">{{ comment.author }}</span>

                      <span class="caption-with-letter-spacing">
                        {{- comment.created_at | time_tag: format: 'date' -}}
                      </span>
                    </header>
                  </div>
                  <div  class="article-template__comments-comment">
                    {{ comment.content }}
                  </div>
                </article>
              {%- endfor -%}
              {% render 'pagination', paginate: paginate, anchor: anchorId %}
            </div>
          {% endpaginate %}
        {%- endif -%}

        {% form 'new_comment', article %}
          {%- liquid
            assign post_message = 'blogs.article.success'
            if blog.moderated? and comment.status == 'unapproved'
              assign post_message = 'blogs.article.success_moderated'
            endif
          -%}
          <h2>{{ 'blogs.article.comment_form_title' | t }}</h2>
          {%- if form.errors -%}
            <div class="form__message" role="alert">
              <h3 class="form-status caption-large text-body" tabindex="-1" autofocus>
                <span class="svg-wrapper">
                  {{- 'icon-error.svg' | inline_asset_content -}}
                </span>
                {{ 'templates.contact.form.error_heading' | t }}
              </h3>
            </div>
            <ul class="form-status-list caption-large">
              {%- for field in form.errors -%}
                <li>
                  <span class='link'>
                    {%- if form.errors.translated_fields[field] contains 'author' -%}
                      {{ 'blogs.article.name' | t }}
                    {%- elsif form.errors.translated_fields[field] contains 'body' -%}
                      {{ 'blogs.article.message' | t }}
                    {%- else -%}
                      {{ form.errors.translated_fields[field] }}
                    {%- endif -%}
                    {{ form.errors.messages[field] }}
                  </span>
                </li>
              {%- endfor -%}
            </ul>
          {%- elsif form.posted_successfully? -%}
            <div class="form-status-list form__message" role="status">
              <h3 class="form-status success" tabindex="-1" autofocus>
                <span class="svg-wrapper">
                  {{- 'icon-success.svg' | inline_asset_content -}}
                </span>
                {{ post_message | t }}
              </h3>
            </div>
          {%- endif -%}

          <div
              {% if blog.moderated? == false %}
                class="article-template__comments-fields"
              {% endif %}
          >
            <div class="article-template__comment-fields">
              <div class="field field--with-error">
                <input
                    type="text"
                    name="comment[author]"
                    id="CommentForm-author"
                    class="field__input"
                    autocomplete="name"
                    value="{{ form.author }}"
                    aria-required="true"
                    required
                    {% if form.errors contains 'author' %}
                      aria-invalid="true"
                      aria-describedby="CommentForm-author-error"
                    {% endif %}
                    placeholder="{{ 'blogs.article.name' | t }}"
                >
                <label class="field__label" for="CommentForm-author">
                  {{- 'blogs.article.name' | t }}
                  <span aria-hidden="true">*</span></label
                >
              </div>
              <div class="field field--with-error">
                <input
                    type="email"
                    name="comment[email]"
                    id="CommentForm-email"
                    autocomplete="email"
                    class="field__input"
                    value="{{ form.email }}"
                    autocorrect="off"
                    autocapitalize="off"
                    aria-required="true"
                    required
                    {% if form.errors contains 'email' %}
                      aria-invalid="true"
                      aria-describedby="CommentForm-email-error"
                    {% endif %}
                    placeholder="{{ 'blogs.article.email' | t }}"
                >
                <label class="field__label" for="CommentForm-email">
                  {{- 'blogs.article.email' | t }}
                  <span aria-hidden="true">*</span></label
                >
              </div>
            </div>
            <div class="field field--with-error">
              <textarea
                  rows="5"
                  name="comment[body]"
                  id="CommentForm-body"
                  class="text-area field__input"
                  aria-required="true"
                  required
                {% if form.errors contains 'body' %}
                  aria-invalid="true"
                  aria-describedby="CommentForm-body-error"
                {% endif %}
                placeholder="{{ 'blogs.article.message' | t }}"
              >{{ form.body }}</textarea>
              <label class="form__label field__label" for="CommentForm-body">
                {{- 'blogs.article.message' | t }}
                <span aria-hidden="true">*</span></label
              >
            </div>
          </div>
          {%- if blog.moderated? -%}
            <p class="article-template__comment-warning caption">{{ 'blogs.article.moderated' | t }}</p>
          {%- endif -%}
          <input type="submit" class="button" value="{{ 'blogs.article.post' | t }}">
        {% endform %}
      </div>
    </div>
  {%- endif -%}
</article>

<script>
    const sliderImages = new Swiper('.article__slider', {
        slidesPerView: 1,
        loop: true,
        pagination: {
            el: '.banner__pagination',
        },
        breakpoints: {
            '767': {
                slidesPerView: 2,
            },
        }
    });
</script>

{% if article %}
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Recipe",
      "name": "{{ article.title | escape }}",
      "description": "{{ article.excerpt | escape }}",
      "totalTime": "PT{{ time | replace: ' minutes', 'M' | replace: ' hours', 'H' | replace: ' hour', 'H' }}",
      "author": {
        "@type": "Person",
        "name": "Bester Caviar"
      },
      "recipeCuisine": "Recipes with caviar",
      "recipeYield": "{{ servings }}",
      "image": [
        "{{ article.featured_image | img_url: 'original' | escape }}"
      ]
    }
  </script>
{% endif %}

{% schema %}
{
  "name": "t:sections.main-article.name",
  "tag": "section",
  "class": "section"
}
{% endschema %}
